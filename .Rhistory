library(rCurl)
??curl
library(httr)
GET(http://www.oie.int/wahis_2/public/wahid.php/Diseaseinformation/Immsummary)
GET("http://www.oie.int/wahis_2/public/wahid.php/Diseaseinformation/Immsummary")
test <- GET("http://www.oie.int/wahis_2/public/wahid.php/Diseaseinformation/Immsummary")
test
str(test)
?RCurl
?Rcurl
?rCurl
install.packages("httr")
??rCurl
library(RCurl)
?RCurl
url <- "http://www.oie.int/wahis_2/public/wahid.php/Diseaseinformation/Immsummary"
install.packages("RHTMLForms")
install.packages("RHTMLForms", repos = "http://www.omegahat.org/R")
install.packages("RHTMLForms", repos = "http://www.omegahat.org/R", type = "source")
library(RHTMLForms)
?RHTMLForms
form <- getHTMLFormDescription(url)
form
form$diseaseform
form[[1]]
form[[2]]
forms <- getHTMLFormDescription(url)
fun <- createFunction(forms[[2]])
fun
fun()
test <- fun(disease_id_terrestrial = "12")
test
str(test)
??write
?file
cat(test, file = "test.html")
names(forms)
forms[["diseaseform"]]
args(fun)
summary_dir <- "summaries"
years <- 2004:2014
years_char <- as.character(years)
disease_id_terrestrial = "12"
summaries <- lapply(years_char, fun, disease)
disease = "12"
summaries <- lapply(years_char, fun, disease)
fun
summaries <- lapply(years_char, function(x) fun(year = x, disease_id_terrestrial = disease)
)
years <- 2005:2014
summaries <- lapply(years_char, function(x) fun(year = x, disease_id_terrestrial = disease))
summaries <- lapply(years, function(x) fun(year = x, disease_id_terrestrial = disease))
years <- 2004:2014
years <- 2004:2005
summaries <- lapply(years, function(x) fun(year = x, disease_id_terrestrial = disease))
names(summaries)
summaries
dim(summaries)
edit(summaries)
?list
summaries[[1]]
summaries[[2]]
summaries <- sapply(years, function(x) fun(year = x,
disease_id_terrestrial = disease
simplify = FALSE)
)
summaries <- sapply(years, function(x) {
fun(year = x,
disease_id_terrestrial = disease
simplify = FALSE)
}
)
summaries <- sapply(years,
function(x) {
fun(year = x,
disease_id_terrestrial = disease,
simplify = FALSE)
}
)
years <- 2005:2014
summaries <- sapply(years,
function(x) {
fun(year = x,
disease_id_terrestrial = disease,
simplify = FALSE)
}
)
summaries <- sapply(years,
function(x) {
fun(year = x,
disease_id_terrestrial = disease)
},
,
simplify = FALSE)
summaries_dir <- "summaries"
summaries_fun <- createFunction(forms[["diseaseform"]]) # RHTMLForms
function(x) {
summaries_fun(year = x,
disease_id_terrestrial = disease)
},
,
simplify = FALSE)
summaries <- sapply(years,
function(x) {
summaries_fun(year = x,
disease_id_terrestrial = disease)
},
,
simplify = FALSE)
sapply
sapply(2005:2014, print)
sapply(2005:2014, function(x) print)
sapply(2005:2014, function(x) print(x))
sapply(2005:2014, function(x) print(x), simplify = FALSE)
length(summaries)
summaries <- lapply(years,
function(x) {
summaries_fun(year = x,
disease_id_terrestrial = disease)
},
,
simplify = FALSE)
summaries <- sapply(years,
function(x) {
summaries_fun(year = x,
disease_id_terrestrial = disease)
},
simplify = FALSE)
length(summaries)
names(summaries)
years_char <- as.character(years)
names(summaries) <- years_char
summaries
names(years) <- years_char
summaries <- sapply(years,
function(x) {
summaries_fun(year = x,
disease_id_terrestrial = disease)
},
simplify = FALSE)
names(summaries)
write(summaries[[1]], "")
??path
help.search("path", package = "base")
file.path()
file.path(summaries_dir)
file.path(summaries_dir, "2014")
names(summaries[[1]])
str(summaries[[1]])
paste0(years_char)
paste0(years_char, ".html")
paste0(summaries_dir, years_char, ".html")
file.path(summaries_dir, paste0(years_char, ".html"))
summaries_files <- file.path(summaries_dir,
paste0(years_char,
".html")
)
mapply(write,
x = summaries,
file = summaries_files)
??"make directory"
?md
?create.file
??create.file
??file
help.search("file", package = "base")
dir.create(summaries_dir)
mapply(write,
x = summaries,
file = summaries_files)
mapply(write,
x = summaries,
file = summaries_files,
SIMPLIFY = TRUE)
junk <- mapply(write,
x = summaries,
file = summaries_files)
write(Sys.Date,
file = file.path(summaries_dir,
"date_downloaded.txt")
)
Sys.Date
Sys.Date()
write(Sys.Date(),
file = file.path(summaries_dir,
"date_downloaded.txt")
)
Sys.time()
format(Sys.time(), "%Y-")
format(Sys.time(), "%Y-%M")
format(Sys.time())
write(format(Sys.time()),
file = file.path(summaries_dir,
"date_downloaded.txt")
)
library(XML)
test <- htmlParse(summaries[[1]])
test
str(test)
test1 <- readHTMLTable(test)
str(test1)
test1[[1]]
test1[[2]]
test1[[3]]
write(test1[[3]], file = "test.txt")
str(test1[[3]])
test2 <- test1[[3]]
View(test2)
test2[4, 1]
test <- htmlTreeParse(summaries[[1]])
test
names(test)
names(test$children)
names(test$children$html)
names(test$children$html$body)
test$children$html$body
test$children$html
names(test$children$html)
test <- htmlTreeParse(summaries[[1]], asText = TRUE)
test
getHTMLLinks(summaries[[1]])
test <- htmlTreeParse(summaries[[1]])
doc <- htmlTreeParse(summaries[[1]])
xpathApply(doc)
xpathApply(doc, "//table[@class='Table27']"")
"
xpathApply(doc, "//table[@class='Table27']")
xpathApply(doc, "//table[@class='Table27']", print)
getNodeSet(doc, "//table[@class='Table27']", print)
getNodeSet(doc, "//table[@class='Table27']")
xmlRoot(doc)
getNodeSet(doc, "//table[@class='Table27']")
doc <- htmlTreeParse(summaries[[1]], useInternalNodes = TRUE)
getNodeSet(doc, "//table[@class='Table27']")
tb <- getNodeSet(doc, "//table[@class='Table27']")
sapply(tb[["thead"]][["tr"]]["th"], xmlValue)
sapply(tb[["tbody"]]["tr"],  function(x) sapply(x["td"], xmlValue))
readHTMLTable =
function(tb)
{
# get the header information.
colNames = sapply(tb[["thead"]][["tr"]]["th"], xmlValue)
vals = sapply(tb[["tbody"]]["tr"],  function(x) sapply(x["td"], xmlValue))
matrix(as.numeric(vals[-1,]),
nrow = ncol(vals),
dimnames = list(vals[1,], colNames[-1]),
byrow = TRUE
)
}
tables = lapply(o, readHTMLTable)
o <- getNodeSet(doc, "//table[@class='Table27']")
tables = lapply(o, readHTMLTable)
o
o[[1]]
names(o)
names(o[[1]])
names(o[[1]][["tbody"]])
o[[1]][["tbody"]][["tr"]]
o[[1]][["tbody"]][[1]]
o[[1]][["tbody"]][[2]]
o[[1]][["tbody"]][[5]]
o[[1]][["tbody"]][[6]]
o[[1]][["tbody"]][[7]]
o <- getNodeSet(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']")
o
o
readHTMLTable(o)
readHTMLTable(o[[1]])
o[[1]]
names(forms)
tmp = xmlSApply(doc, function(x) xmlSApply(x, xmlValue))
doc <- xmlRoot(htmlTreeParse(summaries[[1]], useInternalNodes = TRUE))
tmp = xmlSApply(doc, function(x) xmlSApply(x, xmlValue))
tmp[""body]
tmp["body"]
o <- getNodeSet(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']")
o
table(names(doc))
table(names(o[[1]]))
o[[1]]
o <- getNodeSet(doc, "//table[@class='Table27']//tr")
o
o <- xpathSApply(doc, "//table[@class='Table27']//tr")
o
o <- xpathSApply(doc, "//table[@class='Table27']//td")
o
o <- xpathSApply(doc, "//table[@class='Table27']//td[@class='outbreak_country']")
o
o <- xpathSApply(doc, "//table[@class='Table27']//td[@class='*outbreak_country']")
o
o <- xpathSApply(doc, "//table[@class='Table27']//td[@class='filtrer_tds vacborder outbreak_country']")
o
o <- xpathSApply(doc, "//table[@class='Table27']//td[@class='filtrer_tds vacborder outbreak_country'][text()]")
o
o <- xpathSApply(doc, "//table[@class='Table27']//td[@class='filtrer_tds vacborder outbreak_country' text()]")
o <- xpathSApply(doc, "//table[@class='Table27']//td[@class='filtrer_tds vacborder outbreak_country', text()]")
o <- xpathSApply(doc, "//table[@class='Table27']//td[@class='filtrer_tds vacborder outbreak_country']")
o
o <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country']")
O
o
o <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country'] | //table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']")
o
o <- getNodeSet(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country'] | //table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']")
o
doc <- xmlRoot(htmlTreeParse(summaries[[2]], useInternalNodes = TRUE))
o <- getNodeSet(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country'] | //table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']")
o
o <- getNodeSet(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country']/text() | //table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder/text()']")
o
o[[1]]
o <- getNodeSet(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country']/text() | //table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/text()")
o
o <- getNodeSet(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country']/text() | //table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/node()")
o
o <- getNodeSet(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country']/text() | //table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']")
o
country_list <- getNodeSet(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country']/text()")
country_list
country_list <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder outbreak_country']/text()")
country_list
resolved_list <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/text()"
)
resolved_list <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/text()")
resolved_list
length(country_list)
length(resolved_list)
seq(2, length(resolved_list), by = 8)
temp_resolved_list <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/text()")
resolved_list <- temp_resolved_list[[seq(2, length(temp_resolved_list), by = 8)]]
temp_resolved_list
temp_resolved_list[[c(2, 10)]]
temp_resolved_list[[c(2)]]
temp_resolved_list[[list(2, 10)]]
temp_resolved_list[list(2, 10)]
temp_resolved_list[c(2, 10)]
resolved_list <- temp_resolved_list[seq(2, length(temp_resolved_list), by = 8)]
resolved_list
temp_status_list <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/text()")
temp_status_list
status_list <- temp_status_list[seq(1, length(temp_resolved_list), by = 8)]
status_list
temp_date_list <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/text()")
date_list <- temp_date_list[seq(2, length(temp_date_list), by = 8)]
date_list
temp_outbreak_links_list <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[@href='javascript:;']")
temp_outbreak_links_list
temp_outbreak_links_list <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[@href='javascript:;']/@onclick")
temp_outbreak_links_list
temp_outbreak_links_list <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[@href='javascript:;']/@onclick", simplify = FALSE)
temp_outbreak_links_list
temp_outbreak_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[@href='javascript:;']/@onclick")
temp_outbreak_links_char
outbreak_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[@href='javascript:;']/@onclick")
event_summary_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[@href='/wahis_2/*']/@href")
event_summary_links_char
event_summary_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[contains((@href, '/wahis_2/'))]/@href")
event_summary_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a/@href")
event_summary_links_char
event_summary_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']//[contains((@href, '/wahis_2/'))]/@href")
event_summary_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']//*[contains((@href, '/wahis_2/'))]/@href")
event_summary_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']//*[contains((@href, 'viewsummary'))]/@href")
event_summary_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[contains((@href, 'viewsummary'))]/@href")
event_summary_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[contains(@href, 'viewsummary')]/@href")
event_summary_links_char
full_report_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[contains(@href, 'Reviewreport')]/@href")
full_report_links_char
full_report_links_char <- xpathSApply(doc, "//table[@class='Table27']//tr[@class='outbreakdetails']//td[@class='filtrer_tds vacborder']/a[contains(@href, 'page_refer=MapFullEventReport')]/@href")
full_report_links_char
